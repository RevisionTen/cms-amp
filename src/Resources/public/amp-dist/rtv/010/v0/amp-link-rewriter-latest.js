(self.AMP=self.AMP||[]).push({n:"amp-link-rewriter",v:"0",f:(function(AMP,_){
var m="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},p;if("function"==typeof Object.setPrototypeOf)p=Object.setPrototypeOf;else{var r;a:{var t={a:!0},u={};try{u.__proto__=t;r=u.a;break a}catch(a){}r=!1}p=r?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var v=p;(function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a})(this);function x(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var y=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var z=self.__AMP_LOG;function B(a){z.user||(z.user=C());var b=z.user.win;return a&&a.ownerDocument.defaultView!=b?z.userForEmbed?z.userForEmbed:z.userForEmbed=C():z.user}function C(){throw Error("failed to call initLogConstructor");};var D=Object.prototype.hasOwnProperty;function E(a,b){if(a.__AMP__EXPERIMENT_TOGGLES)var c=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);c=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var d in a.AMP_CONFIG){var e=a.AMP_CONFIG[d];"number"===typeof e&&0<=e&&1>=e&&(c[d]=Math.random()<e)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length&&(d=a.AMP_CONFIG["allow-doc-opt-in"],e=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]'))){e=
e.getAttribute("content").split(",");for(var g=0;g<e.length;g++)-1!=d.indexOf(e[g])&&(c[e[g]]=!0)}Object.assign(c,F(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){d=a.AMP_CONFIG["allow-url-opt-in"];e=a.location.originalHash||a.location.hash;a=Object.create(null);if(e)for(var k;k=y.exec(e);)g=x(k[1],k[1]),k=k[2]?x(k[2].replace(/\+/g," "),k[2]):"",a[g]=k;for(e=0;e<d.length;e++)g=a["e-"+d[e]],"1"==g&&(c[d[e]]=!0),"0"==g&&(c[d[e]]=!1)}}var q=
c;return!!q[b]}function F(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(e){if(z.dev)a=z.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var d=0;d<c.length;d++)0!=c[d].length&&("-"==c[d][0]?a[c[d].substr(1)]=!1:a[c[d]]=!0);return a};var H={},I=(H["ampdoc-fie"]={isTrafficEligible:function(){return!0},branches:[["21065001"],["21065002"]]},H);function J(a,b){var c=K(a);c=L(c);return M(c,b)}function K(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=M(b,"ampdoc").getAmpDoc(a)}return a}function L(a){a=K(a);return a.isSingleDoc()?a.win:a}function M(a,b){N(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});var d=c;a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function N(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var O;function P(a){var b=void 0,c=Q,d=b||function(a){return a},e=a.dataset;a={};var g=c?c:/^param(.+)/,k;for(k in e){var q=k.match(g);if(q){var h=q[1][0].toLowerCase()+q[1].substr(1);a[d(h)]=e[k]}}return a}function R(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)};function S(a){var b={};Object.keys(a).forEach(function(c){b[c]="^"+a[c]+"$"});return b};function aa(a,b){var c=a.getRootNode(),d=b.section.join(" a, "),e=c.querySelectorAll("a"),g=[];0!==b.section.length&&(d+=" a",e=c.querySelectorAll(d));R(e,function(a){ba(a,b)&&g.push(a)});return g}function ba(a,b){var c=b.attribute,d=Object.keys(c);return d.every(function(b){var d=new RegExp(c[b]);return d.test(a.getAttribute(b))})};var ca=["href","id","rel","rev"],Q=/^vars(.+)/,T=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,da={SOURCE_URL:!0,DOCUMENT_REFERRER:!0};
function U(a,b,c){this.j=c;c=b;try{/^[\w-]+$/.test("script");if(void 0!==O)var d=O;else{try{var e=c.ownerDocument,g=e.createElement("div"),k=e.createElement("div");g.appendChild(k);var q=g.querySelector(":scope div")===k}catch(G){q=!1}d=O=q}if(d)var h=c.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{c.classList.add("i-amphtml-scoped");var X="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),ea=c.querySelectorAll(X);c.classList.remove("i-amphtml-scoped");h=ea}var w=h;if(1!==w.length)throw Error("Found "+
w.length+" <script> children. Expected 1.");var A=w[0];if("SCRIPT"!=A.tagName||!A.hasAttribute("type")||"APPLICATION/JSON"!=A.getAttribute("type").toUpperCase())throw Error('<script> child must have type="application/json"');try{var n=JSON.parse(A.textContent)}catch(G){throw Error("Failed to parse <script> contents. Is it valid JSON?");}var l=n}catch(G){throw B(c).createError("%s: %s","amp-link-rewriter",G);}n=l.output;B().assert(n,"amp-link-rewriter: output config property is required",void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0);this.l={output:l.output.toString(),section:D.call(l,"section")?l.section:[],attribute:D.call(l,"attribute")?S(l.attribute):{},vars:D.call(l,"vars")?l.vars:{}};this.m=aa(this.j,this.l);this.h=a;this.c="";l=b;n=l.ownerDocument.defaultView;h=n.__AMP_TOP||(n.__AMP_TOP=n);w=n!=h;if(E(h,"ampdoc-fie")){h.__AMP_EXPERIMENT_BRANCHES=h.__AMP_EXPERIMENT_BRANCHES||{};for(f in I)D.call(I,f)&&!D.call(h.__AMP_EXPERIMENT_BRANCHES,f)&&(I[f].isTrafficEligible&&I[f].isTrafficEligible(h)?
!h.__AMP_EXPERIMENT_BRANCHES[f]&&E(h,f)&&(d=I[f].branches,h.__AMP_EXPERIMENT_BRANCHES[f]=d[Math.floor(Math.random()*d.length)]||null):h.__AMP_EXPERIMENT_BRANCHES[f]=null);var f="21065002"===(h.__AMP_EXPERIMENT_BRANCHES?h.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else f=!1;w&&!f?f=N(n,"url-replace")?M(n,"url-replace"):null:(f=K(l),f=L(f),f=N(f,"url-replace")?M(f,"url-replace"):null);this.A=f}
U.prototype.handleClick=function(a){if(a&&(this.c=this.l.output,a.href.match(T)[1]!==this.c.match(T)[1]&&fa(this,a))){var b=J(this.j,"documentInfo").get().sourceUrl.match(T)[1],c=J(this.j,"documentInfo").get().canonicalUrl.match(T)[1];if(!ha(a,[b,c])){var d=a;this.c=this.A.expandUrlSync(this.c,{DOCUMENT_REFERRER:this.h},void 0,da);var e=this.l.vars;e instanceof Object&&(d.href=ia(this,d,e))}}};
function fa(a,b){if(null===a.m||0===a.m.length)return!0;var c=a.m.filter(function(a){return a===b});return 0<c.length?!0:!1}function ha(a,b){var c=a.href;return b.some(function(a){var b=c.match(T);return b?T.test(c)&&b[1]===a:!0})}
function ia(a,b,c){ca.forEach(function(a){b.getAttribute(a)&&(c[a]=b.getAttribute(a))});var d=P(b);Object.assign(c,d);c.random=Math.random().toString(32).substr(2);Object.keys(c).forEach(function(b){c[b]&&(a.c=a.c.replace("${"+b+"}",encodeURIComponent(c[b])))});a.c=a.c.replace(/\${[A-Za-z0-9]+}+/,function(){return""});return a.c};function V(a){a=AMP.BaseElement.call(this,a)||this;a.o=null;a.h="";return a}var W=AMP.BaseElement;V.prototype=m(W.prototype);V.prototype.constructor=V;if(v)v(V,W);else for(var Y in W)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(W,Y);Z&&Object.defineProperty(V,Y,Z)}else V[Y]=W[Y];V.B=W.prototype;
V.prototype.buildCallback=function(){var a=this,b=J(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then(function(){return b.getReferrerUrl()}).then(function(b){return a.h=b}).then(this.w.bind(this))};V.prototype.w=function(){this.o=new U(this.h,this.element,this.getAmpDoc());ja(this)};function ja(a){var b=J(a.getAmpDoc(),"navigation");b.registerAnchorMutator(function(b){a.o.handleClick(b)},0)}V.prototype.isLayoutSupported=function(a){return"nodisplay"===a};
(function(a){a.registerElement("amp-link-rewriter",V)})(self.AMP);
})});

//# sourceMappingURL=amp-link-rewriter-0.1.js.map
