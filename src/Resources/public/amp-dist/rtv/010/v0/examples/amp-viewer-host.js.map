{"version":3,"sources":["http://localhost:8000/extensions/amp-viewer-integration/0.1/messaging/messaging.js","http://localhost:8000/extensions/amp-viewer-integration/0.1/examples/amp-viewer-host.js"],"names":["TAG","CHANNEL_OPEN_MSG","HANDSHAKE_POLL_MSG","APP","MessageType","REQUEST","RESPONSE","RequestHandler","parseMessage","message","charAt","JSON","parse","e","WindowPortEmulator","constructor","win","origin","target","win_","origin_","target_","addEventListener","eventType","handler","event","source","postMessage","data","targetOrigin","start","Messaging","port","opt_isWebview","opt_token","opt_verifyToken","port_","isWebview_","token_","verifyToken_","requestIdCounter_","waitingForResponse_","messageHandlers_","defaultHandler_","handleMessage_","bind","initiateHandshakeWithDocument","Promise","resolve","intervalRef","setInterval","channel","MessageChannel","pollMessage","app","name","port2","port1","listener","clearInterval","removeEventListener","messaging","sendResponse_","requestid","waitForHandshakeFromDocument","registerHandler","messageName","requestHandler","unregisterHandler","setDefaultHandler","messagingToken","logError_","type","handleRequest_","handleResponse_","sendRequest","messageData","awaitResponse","requestId","promise","undefined","reject","sendMessage_","rsvp","sendResponseError_","reason","errString","errorToString_","error","finalMessage","Object","assign","stringify","Error","args","then","pending","state","opt_data","stateStr","dataStr","err","String","exports","AmpViewerHost","ampIframe","frameOrigin","messageHandler","opt_logsId","opt_isHandshakePoll","ampIframe_","messageHandler_","logsId","contentWindow","messaging_","completeHandshake_","visibilityState_","prerenderSize","log","var_args","Array","prototype","slice","call","arguments","unshift","console","apply","self"],"mappings":"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","file":"amp-viewer-host.js","sourcesContent":[]}