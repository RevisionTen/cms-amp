(self.AMP=self.AMP||[]).push({n:"amp-viewer-assistance",v:"0",f:(function(AMP,_){
function h(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var k=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var l=self.__AMP_LOG;function m(){if(!l.user)throw Error("failed to call initLogConstructor");return l.user};var n=Object.prototype.hasOwnProperty;function p(a){return a||{}};p({c:!0,v:!0,a:!0,ad:!0,action:!0});function q(a,b){if(a.__AMP__EXPERIMENT_TOGGLES)var c=a.__AMP__EXPERIMENT_TOGGLES;else{a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);c=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var e in a.AMP_CONFIG){var d=a.AMP_CONFIG[e];"number"===typeof d&&0<=d&&1>=d&&(c[e]=Math.random()<d)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length&&(e=a.AMP_CONFIG["allow-doc-opt-in"],d=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]'))){d=
d.getAttribute("content").split(",");for(var f=0;f<d.length;f++)-1!=e.indexOf(d[f])&&(c[d[f]]=!0)}Object.assign(c,t(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){e=a.AMP_CONFIG["allow-url-opt-in"];d=a.location.originalHash||a.location.hash;a=Object.create(null);if(d)for(var g;g=k.exec(d);)f=h(g[1],g[1]),g=g[2]?h(g[2].replace(/\+/g," "),g[2]):"",a[f]=g;for(d=0;d<e.length;d++)f=a["e-"+e[d]],"1"==f&&(c[e[d]]=!0),"0"==f&&(c[e[d]]=!1)}}var r=
c;return!!r[b]}function t(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(d){if(l.dev)a=l.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var e=0;e<c.length;e++)0!=c[e].length&&("-"==c[e][0]?a[c[e].substr(1)]=!1:a[c[e]]=!0);return a};var u={},v=(u["ampdoc-fie"]={isTrafficEligible:function(){return!0},branches:[["21065001"],["21065002"]]},u);function w(a){var b=a.ownerDocument.defaultView,c=b.__AMP_TOP||(b.__AMP_TOP=b),e=b!=c;var d=c;if(q(d,"ampdoc-fie")){d.__AMP_EXPERIMENT_BRANCHES=d.__AMP_EXPERIMENT_BRANCHES||{};for(var f in v)if(n.call(v,f)&&!n.call(d.__AMP_EXPERIMENT_BRANCHES,f))if(v[f].isTrafficEligible&&v[f].isTrafficEligible(d)){if(!d.__AMP_EXPERIMENT_BRANCHES[f]&&q(d,f)){var g=v[f].branches;d.__AMP_EXPERIMENT_BRANCHES[f]=g[Math.floor(Math.random()*g.length)]||null}}else d.__AMP_EXPERIMENT_BRANCHES[f]=null;d="21065002"===(d.__AMP_EXPERIMENT_BRANCHES?
d.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else d=!1;var r=d;e&&!r?a=x(b,"action")?y(b,"action"):null:(a=z(a),a=A(a),a=x(a,"action")?y(a,"action"):null);return a}function B(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return y(a,b)}function C(a){var b=z(a);b=A(b);return y(b,"viewer")}function z(a){return a.nodeType?B((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function A(a){a=z(a);return a.isSingleDoc()?a.win:a}
function y(a,b){x(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});var e=c;a=e[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function x(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function D(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}};var E=["ACTIVE_ACTION_STATUS","FAILED_ACTION_STATUS","COMPLETED_ACTION_STATUS"];function F(a){var b=a.getElementById("amp-viewer-assistance");if(this.l=!!b)this.o=a,this.j=b,this.A=D(this.j.textContent,function(a){throw m().createError('Failed to parse "amp-viewer-assistance" JSON: '+a);}),this.h=C(a),this.m=w(this.j),this.B=B(a.win,"vsync")}
F.prototype.w=function(a){var b=this,c=a,e=c.method;c=c.args;"updateActionState"==e?a.satisfiesTrust(1)&&G(c).then(function(a){return b.h.sendMessageAwaitResponse(e,a)}).catch(function(a){m().error("amp-viewer-assistance",a.toString())}):"signIn"==e&&a.satisfiesTrust(100)&&H(this);return null};
function I(a){return a.l?a.h.isTrustedViewer().then(function(b){if(!b&&!q(a.o.win,"amp-viewer-assistance-untrusted"))return a.l=!1,m().error("amp-viewer-assistance","amp-viewer-assistance is currently only supported on trusted viewers."),a;a.m.installActionHandler(a.j,a.w.bind(a));a.getIdTokenPromise();a.h.sendMessage("viewerAssistanceConfig",p({config:a.A}));return a}):(m().error("amp-viewer-assistance","Could not find #amp-viewer-assistance element."),a)}
F.prototype.getIdTokenPromise=function(){var a=this;return this.h.sendMessageAwaitResponse("getAccessTokenPassive",p({providers:["actions-on-google-gsi"]})).then(function(b){J(a,!!b);return b}).catch(function(){J(a,!1)})};function H(a){a.h.sendMessageAwaitResponse("requestSignIn",p({providers:["actions-on-google-gsi"]})).then(function(b){m().info("amp-viewer-assistance","Token: "+b);b?(J(a,!0),a.m.trigger(a.j,"signedIn",null,100)):J(a,!1)})}
function G(a){if(!a)return Promise.reject('"updateActionState" was called with no arguments!"');var b=a.update,c=a.error;if(c&&b)return Promise.reject('"updateActionState" must have only one of the parameters "error" and "update".');if(c)return c&&"function"===typeof c.text?c.text().then(function(a){return p({update:{actionStatus:"FAILED_ACTION_STATUS",result:{code:c.status,message:a}}})}):Promise.reject('"updateActionState" action "error" parameter must contain a valid "response" object.');if(b){var e=
b&&b.actionStatus;return e&&E.includes(e)?Promise.resolve(a):Promise.reject('"updateActionState" action "update" parameter must contain a valid "actionStatus" field.')}return Promise.reject('"updateActionState" action must have an "update" or "error" parameter.')}function J(a,b){var c="amp-viewer-assistance-identity-available";a.B.mutate(function(){var e=a.o.getRootNode();(e.documentElement||e.body||e).classList.toggle(c,b)})}(function(a){a.registerServiceForDoc("amp-viewer-assistance",function(a){return I(new F(a))})})(self.AMP);
})});

//# sourceMappingURL=amp-viewer-assistance-0.1.js.map
